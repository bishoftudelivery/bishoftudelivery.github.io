<!DOCTYPE html>
<html lang="am" data-version="12.0">
<head>
    <meta name="google-site-verification" content="Yo225u8qpEADrbmyCChQZ9zOZ9pNeUwm1meyq8ChHh4" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‰¢áˆ¾áá‰± á‹´áˆŠá‰¨áˆª | Bishoftu Delivery</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#ff4500">
    <meta name="description" content="á‰¢áˆ¾áá‰± á‹áˆµáŒ¥ áˆáŒá‰¥ áˆ›á‹µáˆ¨áˆ» - Food Delivery Service in Bishoftu">
    <link rel="manifest" href="./manifest.json?v=12">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BishoftuEats">
    <link rel="apple-touch-icon" href="./icons/icon-152x152.png?v=12">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./icons/favicon.ico?v=12">
    
    <style>
        :root { --primary: #ff4500; --dark: #1a1a1a; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: var(--bg); padding-bottom: 100px; direction: ltr; }
        header { background: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .streak-fire { display: flex; justify-content: center; gap: 8px; margin: 5px 0; }
        .fire { font-size: 24px; filter: grayscale(100%); opacity: 0.2; transition: 0.5s; }
        .fire.active { filter: grayscale(0%); opacity: 1; animation: burn 1.5s infinite; }
        @keyframes burn { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        .container { max-width: 600px; margin: auto; padding: 15px; }
        .res-title { background: var(--primary); color: white; padding: 10px; border-radius: 8px; margin: 20px 0 10px; font-size: 1.2rem; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; display: flex; flex-direction: column; }
        .card img { width: 100%; height: 110px; object-fit: cover; background: linear-gradient(45deg, #f5f5f5, #e0e0e0); }
        .card-info { padding: 10px; }
        .card-title { font-size: 0.85rem; font-weight: 600; margin: 0; min-height: 35px; }
        .card-price { color: var(--primary); font-weight: bold; font-size: 0.9rem; }
        .card input { position: absolute; top: 8px; right: 8px; width: 20px; height: 20px; accent-color: var(--primary); }

        /* Modal Style */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: white; margin: 15% auto; padding: 20px; border-radius: 15px; width: 85%; max-width: 400px; text-align: center; }
        .payment-info { background: #f0f0f0; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: left; font-size: 0.9rem; }
        
        .floating-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        .btn { background: var(--primary); color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; }
        input[type="text"], input[type="tel"] { width: 100%; padding: 12px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        /* PWA Popup */
        .pwa-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10001;
            width: 85%;
            max-width: 300px;
            text-align: center;
            animation: popupIn 0.3s ease;
            border: 2px solid var(--primary);
        }
        
        @keyframes popupIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        .pwa-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .pwa-title {
            margin: 0 0 8px 0;
            color: var(--dark);
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .pwa-message {
            margin: 0 0 20px 0;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .pwa-buttons {
            display: flex;
            gap: 10px;
        }
        
        .pwa-btn {
            flex: 1;
            padding: 12px 0;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        .pwa-yes {
            background: var(--primary);
            color: white;
        }
        
        .pwa-no {
            background: #f0f0f0;
            color: #666;
        }
        
        /* Location Request Modal */
        .location-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            z-index: 10002;
            width: 90%;
            max-width: 350px;
            text-align: center;
        }
        
        .location-icon {
            font-size: 50px;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .location-title {
            margin: 0 0 10px 0;
            color: var(--dark);
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .location-message {
            margin: 0 0 25px 0;
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .location-buttons {
            display: flex;
            gap: 10px;
        }
        
        .location-btn {
            flex: 1;
            padding: 14px 0;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .location-allow {
            background: var(--primary);
            color: white;
        }
        
        .location-deny {
            background: #f0f0f0;
            color: #666;
        }
        
        /* Offline Indicator */
        #offlineIndicator {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #ff4444;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            z-index: 10000;
            display: none;
        }
        
        /* Delivery Fee Notice */
        .delivery-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.9rem;
            text-align: center;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 10001;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            animation: fadeInOut 3s ease;
            display: none;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            10%, 90% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
    </style>

</head>
<body>

<!-- Offline Indicator -->
<div id="offlineIndicator">ğŸ“¶ áŠ¦ááˆ‹á‹­áŠ• áˆáŠá‹‹áˆ</div>

<!-- Toast Notification -->
<div class="toast" id="toast"></div>

<!-- Location Request Modal -->
<div id="locationModal" class="location-modal">
    <div class="location-icon">ğŸ“</div>
    <div class="location-title">áŠ áŠ«á‰£á‰¢á‹áŠ• á‹«áˆ³á‹á‰</div>
    <div class="location-message">
        áˆáŒá‰¥á‹áŠ• á‰ ááŒ¥áŠá‰µ áˆˆáˆ›á‹µáˆ¨áˆµ á‹¨áŠ¥áˆ­áˆµá‹áŠ• áŠ áŠ«á‰£á‰¢ áˆ›á‹ˆá‰… áŠ áˆˆá‰¥áŠ•á¢
        <br><br>
        <small style="color: #999; font-size: 0.85rem;">
            âš ï¸ áŠ¥á‰£áŠ­á‹ á‹¨áŠ áŠ«á‰£á‰¢ áŠ áŒˆáˆáŒáˆá‰µá‹áŠ• á‹«á‰¥áˆ©!
            <br>ğŸ“ áŠ¨á‰´áˆŒáŒáˆ«áˆ á‰µá‹•á‹›á‹ áŒ‹áˆ­ á‰¥á‰» á‹­áˆ‹áŠ«áˆ
        </small>
    </div>
    <div class="location-buttons">
        <button class="location-btn location-allow" onclick="requestLocation()">áŠ áˆ¨áŒ‹áŒáŒ¥</button>
        <button class="location-btn location-deny" onclick="denyLocation()">áŠ áˆáˆáˆáŒáˆ</button>
    </div>
</div>

<!-- PWA Popup -->
<div id="pwaPopup" class="pwa-popup">
    <div class="pwa-icon">ğŸ“±</div>
    <div class="pwa-title">áŠ á• áŠ áˆ­áŒ</div>
    <div class="pwa-message">á‹ˆá‹° áˆµáˆáŠ­á‹ áˆ˜áŠáˆ» áˆ›á‹áŒ« á‹­áŒ¨áˆáˆ© áˆáŒ£áŠ• áˆ˜á‹³áˆ¨áˆ» á‹«áŒáŠ™</div>
    <div class="pwa-buttons">
        <button class="pwa-btn pwa-yes" onclick="installPWA()">áŒ«áŠ•</button>
        <button class="pwa-btn pwa-no" onclick="dismissPWA()">áŠ á‰µáŒ«áŠ•</button>
    </div>
</div>

<header>
    <h1 style="margin:0; color:var(--dark);">á‰¢áˆ¾áá‰± <span style="color:var(--primary)">á‹´áˆŠá‰¨áˆª</span></h1>
    <div class="streak-fire" id="fireIcons">
        <span class="fire" id="s1">ğŸ”¥</span><span class="fire" id="s2">ğŸ”¥</span><span class="fire" id="s3">ğŸ”¥</span>
    </div>
    <div id="statusMsg" style="font-size: 0.75rem; color: #666;">á‰ á‹¨á‰€áŠ‘ á‰ áˆ›á‹˜á‹ áŠ¥áˆ³á‰±áŠ• á‹«á‰€áŒ£áŒ¥áˆ‰!</div>
</header>

<div class="container">
    <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
        <label>áˆ™áˆ‰ áˆµáˆ</label>
        <input type="text" id="custName" placeholder="áˆµáˆá‹áŠ• á‹«áˆµáŒˆá‰¡">
        <label>áˆµáˆáŠ­ á‰áŒ¥áˆ­</label>
        <input type="tel" id="custPhone" placeholder="09...">
        <label>áˆ˜áˆˆá‹« á‰¦á‰³ (Landmark)</label>
        <input type="text" id="custLandmark" placeholder="áˆˆáˆáˆ³áˆŒá¡ áŠ¥á‰³áˆˆáˆ áˆ†á‰´áˆ áŒ€áˆ­á‰£">
    </div>

    <!-- Delivery Fee Notice -->
    <div class="delivery-notice">
        âš¡ <strong>100 á‰¥áˆ­ á‹¨áˆ˜áˆ‹áŠªá‹« áŠ­áá‹« á‹­áŠ¨áˆáˆ‹áˆ!</strong> (á‹¨áˆ˜áˆ‹áŠªá‹« áŠ­áá‹« á‰ áŒ á‰…áˆ‹áˆ‹ á‹‹áŒ‹ áˆ‹á‹­ á‹­áŒ¨áˆ˜áˆ«áˆ)
    </div>

    <div class="res-title">áŠ¥á‰³áˆˆáˆ áŠ¢áŠ•á‰°áˆ­áŠ“áˆ½áŠ“áˆ áˆ†á‰´áˆ</div>
    <div class="menu-grid">
        <!-- Burger Items -->
        <div class="card"><img src="./assets/double-special-burger.webp?v=12" alt="Double Special Burger"><input type="checkbox" value="Double Special Burger" data-price="700"><div class="card-info"><p class="card-title">Double Special Burger</p><p class="card-price">700 ETB</p></div></div>
        <div class="card"><img src="./assets/special-burger.webp?v=12" alt="Special Burger"><input type="checkbox" value="Special Burger" data-price="500"><div class="card-info"><p class="card-title">Special Burger</p><p class="card-price">500 ETB</p></div></div>
        <div class="card"><img src="./assets/double-beef-burger.webp?v=12" alt="Double Beef Burger"><input type="checkbox" value="Double Beef Burger" data-price="480"><div class="card-info"><p class="card-title">Double Beef Burger</p><p class="card-price">480 ETB</p></div></div>
        <div class="card"><img src="./assets/cheese-burger.webp?v=12" alt="Cheese Burger"><input type="checkbox" value="Cheese Burger" data-price="450"><div class="card-info"><p class="card-title">Cheese Burger</p><p class="card-price">450 ETB</p></div></div>
        <div class="card"><img src="./assets/normal-burger.webp?v=12" alt="Normal Burger"><input type="checkbox" value="Normal Burger" data-price="410"><div class="card-info"><p class="card-title">Normal Burger</p><p class="card-price">410 ETB</p></div></div>
        <div class="card"><img src="./assets/tuna-burger.webp?v=12" alt="Tuna Burger"><input type="checkbox" value="Tuna Burger" data-price="350"><div class="card-info"><p class="card-title">Tuna Burger</p><p class="card-price">350 ETB</p></div></div>
        <div class="card"><img src="./assets/vegetable-burger.webp?v=12" alt="Vegetable Burger"><input type="checkbox" value="Vegetable Burger" data-price="250"><div class="card-info"><p class="card-title">Vegetable Burger</p><p class="card-price">250 ETB</p></div></div>
        <div class="card"><img src="./assets/sandwich-club.webp?v=12" alt="Sandwich Club"><input type="checkbox" value="Sandwich Club" data-price="400"><div class="card-info"><p class="card-title">Sandwich Club</p><p class="card-price">400 ETB</p></div></div>
        
        <!-- Chips -->
        <div class="card"><img src="./assets/chips.webp?v=12" alt="Chips"><input type="checkbox" value="Chips" data-price="250"><div class="card-info"><p class="card-title">Chips (á‰ºá•áˆµ)</p><p class="card-price">250 ETB</p></div></div>
        
        <!-- Pizza Items -->
        <div class="card"><img src="./assets/etalem-special-pizza.webp?v=12" alt="Etalem Special Pizza"><input type="checkbox" value="Etalem Special Pizza" data-price="650"><div class="card-info"><p class="card-title">Etalem Special Pizza</p><p class="card-price">650 ETB</p></div></div>
        <div class="card"><img src="./assets/beef-pizza.webp?v=12" alt="Beef Pizza"><input type="checkbox" value="Beef Pizza" data-price="600"><div class="card-info"><p class="card-title">Beef Pizza</p><p class="card-price">600 ETB</p></div></div>
        <div class="card"><img src="./assets/margaritta-pizza.webp?v=12" alt="Margaritta Pizza"><input type="checkbox" value="Margaritta Pizza" data-price="650"><div class="card-info"><p class="card-title">Margaritta Pizza</p><p class="card-price">650 ETB</p></div></div>
        <div class="card"><img src="./assets/chicken-pizza.webp?v=12" alt="Chicken Pizza"><input type="checkbox" value="Chicken Pizza" data-price="700"><div class="card-info"><p class="card-title">Chicken Pizza</p><p class="card-price">700 ETB</p></div></div>
        <div class="card"><img src="./assets/tuna-pizza.webp?v=12" alt="Tuna Pizza"><input type="checkbox" value="Tuna Pizza" data-price="550"><div class="card-info"><p class="card-title">Tuna Pizza</p><p class="card-price">550 ETB</p></div></div>
        <div class="card"><img src="./assets/vegetable-pizza.webp?v=12" alt="Vegetable Pizza"><input type="checkbox" value="Vegetable Pizza" data-price="350"><div class="card-info"><p class="card-title">Vegetable Pizza</p><p class="card-price">350 ETB</p></div></div>
        
        <!-- Juice Items -->
        <div class="card"><img src="./assets/etalem-special-juice.webp?v=12" alt="Etalem Special Juice"><input type="checkbox" value="Etalem Special Juice" data-price="200"><div class="card-info"><p class="card-title">Etalem Special Juice</p><p class="card-price">200 ETB</p></div></div>
        <div class="card"><img src="./assets/strawberry-juice.webp?v=12" alt="Strawberry Juice"><input type="checkbox" value="Strawberry Juice" data-price="250"><div class="card-info"><p class="card-title">Strawberry Juice</p><p class="card-price">250 ETB</p></div></div>
        <div class="card"><img src="./assets/mixed-juice.webp?v=12" alt="Mixed Juice"><input type="checkbox" value="Mixed Juice" data-price="200"><div class="card-info"><p class="card-title">Mixed Juice</p><p class="card-price">200 ETB</p></div></div>
        
        <!-- Fish Items -->
        <div class="card"><img src="./assets/fish-kotelet.webp?v=12" alt="Fish Kotelet"><input type="checkbox" value="Fish Kotelet" data-price="400"><div class="card-info"><p class="card-title">Fish Kotelet</p><p class="card-price">400 ETB</p></div></div>
        <div class="card"><img src="./assets/grilled-fish.webp?v=12" alt="Grilled Fish"><input type="checkbox" value="Grilled Fish" data-price="400"><div class="card-info"><p class="card-title">Grilled Fish</p><p class="card-price">400 ETB</p></div></div>
    </div>

    <div class="res-title">áŠ«áˆœá‰² (Kameti's Kitchen)</div>
    <div class="menu-grid">
        <!-- Kameti Burger Items -->
        <div class="card"><img src="./assets/kameti-special-burger.webp?v=12" alt="Kameti Special Burger"><input type="checkbox" value="Kameti Special Burger" data-price="500"><div class="card-info"><p class="card-title">Special Burger</p><p class="card-price">500 ETB</p></div></div>
        <div class="card"><img src="./assets/kameti-cheese-burger.webp?v=12" alt="Kameti Cheese Burger"><input type="checkbox" value="Kameti Cheese Burger" data-price="480"><div class="card-info"><p class="card-title">Cheese Burger</p><p class="card-price">480 ETB</p></div></div>
        <div class="card"><img src="./assets/kameti-beef-burger.webp?v=12" alt="Kameti Beef Burger"><input type="checkbox" value="Kameti Beef Burger" data-price="450"><div class="card-info"><p class="card-title">Beef Burger</p><p class="card-price">450 ETB</p></div></div>
        
        <!-- Kameti Pizza Items -->
        <div class="card"><img src="./assets/kameti-large-pizza.webp?v=12" alt="Kameti Large Pizza"><input type="checkbox" value="Kameti Large Pizza" data-price="700"><div class="card-info"><p class="card-title">Large Pizza</p><p class="card-price">700 ETB</p></div></div>
        <div class="card"><img src="./assets/kameti-medium-pizza.webp?v=12" alt="Kameti Medium Pizza"><input type="checkbox" value="Kameti Medium Pizza" data-price="600"><div class="card-info"><p class="card-title">Medium Pizza</p><p class="card-price">600 ETB</p></div></div>
        <div class="card"><img src="./assets/kameti-tuna-pizza.webp?v=12" alt="Kameti Tuna Pizza"><input type="checkbox" value="Kameti Tuna Pizza" data-price="480"><div class="card-info"><p class="card-title">Tuna Pizza</p><p class="card-price">480 ETB</p></div></div>
        
        <!-- Kameti Juice -->
        <div class="card"><img src="./assets/kameti-special-juice.webp?v=12" alt="Kameti Special Juice"><input type="checkbox" value="Kameti Special Juice" data-price="230"><div class="card-info"><p class="card-title">Special Juice</p><p class="card-price">230 ETB</p></div></div>
        
        <!-- Kameti Chips (150 ETB) -->
        <div class="card"><img src="./assets/chips.webp?v=12" alt="Kameti's Chips"><input type="checkbox" value="Kameti's Chips" data-price="150"><div class="card-info"><p class="card-title">Kameti's Chips</p><p class="card-price">150 ETB</p></div></div>
    </div>
</div>

<div id="paymentModal" class="modal">
    <div class="modal-content">
        <h2 style="color:var(--primary)">á‹¨áŠ­áá‹« áˆ˜áˆ¨áŒƒ</h2>
        <p>á‰µá‹•á‹›á‹á‹áŠ• áˆˆáˆ›áˆ¨áŒ‹áŒˆáŒ¥ áŠ¥á‰£áŠ­á‹ áŠ­áá‹«á‹áŠ• á‰€á‹µáˆ˜á‹ á‹­áˆáŒ½áˆ™á¢</p>
        <div class="payment-info">
            <b>á‰£áŠ•áŠ­á¡</b> á‹¨áŠ¢á‰µá‹®áŒµá‹« áŠ•áŒá‹µ á‰£áŠ•áŠ­ (CBE)<br>
            <b>áˆ‚áˆ³á‰¥ á‰áŒ¥áˆ­á¡</b> 1000446752387<br>
            <b>áˆµáˆá¡</b> á‰¢áˆ¾áá‰± á‹´áˆŠá‰¨áˆª<br>
            <b>áˆµáˆáŠ­á¡</b> 0962636940<br>
            <hr>
            <b>á‹¨áˆáŒá‰¥ á‹‹áŒ‹á¡ <span id="foodTotal">0</span> ETB</b><br>
            <b>á‹¨áˆ˜áˆ‹áŠªá‹« áŠ­áá‹«á¡ 100 ETB</b><br>
            <b>áŒ á‰…áˆ‹áˆ‹ á‹‹áŒ‹á¡ <span id="modalTotal">0</span> ETB</b>
        </div>
        <p style="font-size: 0.8rem; color:red;">* áŠ­áá‹«á‹áŠ• áŠ¨áˆáŒ¸áˆ™ á‰ áŠ‹áˆ‹ "á‰ á‰´áˆŒáŒáˆ«áˆ áˆ‹áŠ­" á‹¨áˆšáˆˆá‹áŠ• á‹­áŒ«áŠ‘á¢</p>
        <button class="btn" onclick="sendToTelegram()">á‰µá‹•á‹›á‹™áŠ• á‰ á‰´áˆŒáŒáˆ«áˆ áˆ‹áŠ­</button>
        <button onclick="closeModal()" style="background:none; border:none; margin-top:10px; color:#666; cursor:pointer;">á‰°áˆ˜áˆˆáˆµ</button>
    </div>
</div>

<div class="floating-footer">
    <button class="btn" onclick="openCheckout()">á‰µá‹•á‹›á‹ áŠ áŒ áŠ“á‰… (Checkout)</button>
</div>

<script>
    const BOT_USERNAME = "Bishoftu_Delivery_bot";
    let orderData = {};
    let userLat = null;
    let userLng = null;
    let deferredPrompt = null;
    const DELIVERY_FEE = 100;
    const SITE_URL = "https://mikemoke4444-gif.github.io/delivery_app/";

    // Elements
    const offlineIndicator = document.getElementById('offlineIndicator');
    const toast = document.getElementById('toast');
    const pwaPopup = document.getElementById('pwaPopup');
    const locationModal = document.getElementById('locationModal');

    // Initialize app
    window.onload = () => {
        updateStreakUI();
        initPWA();
        
        // 1. Ask for location immediately
        setTimeout(() => {
            showLocationModal();
        }, 1000);
        
        // 2. Show PWA popup after 10 seconds
        setTimeout(() => {
            showPWApopup();
        }, 10000);
        
        // Check online/offline status
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();
    };

    // Show location modal
    function showLocationModal() {
        // Don't show if already asked in this session
        const locationAsked = sessionStorage.getItem('locationAsked');
        if (locationAsked) return;
        
        locationModal.style.display = 'block';
        sessionStorage.setItem('locationAsked', 'true');
    }

    // Request location permission
    function requestLocation() {
        locationModal.style.display = 'none';
        
        if (!navigator.geolocation) {
            showToast('âŒ áŠ áŠ«á‰£á‰¢ áŠ áŒˆáˆáŒáˆá‰µ á‹¨áˆˆáˆ', 3000);
            return;
        }
        
        showToast('ğŸ“ áŠ áŠ«á‰£á‰¢á‹ áŠ¥á‹¨á‰°áˆ˜á‹˜áŒˆá‰ ...', 2000);
        
        const options = {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
        };
        
        navigator.geolocation.getCurrentPosition(
            (position) => {
                userLat = position.coords.latitude;
                userLng = position.coords.longitude;
                console.log('âœ… Location acquired:', userLat, userLng);
                showToast('âœ… áŠ áŠ«á‰£á‰¢á‹ á‰°áˆ˜á‹áŒá‰§áˆ!', 3000);
                
                sessionStorage.setItem('userLocation', JSON.stringify({
                    lat: userLat,
                    lng: userLng
                }));
            },
            (error) => {
                console.log('âŒ Location error:', error.message);
                let errorMsg = 'âŒ áŠ áŠ«á‰£á‰¢ áˆ›á‹ˆá‰… áŠ áˆá‰°á‰»áˆˆáˆ';
                
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMsg = 'âŒ áŠ áŠ«á‰£á‰¢ áˆá‰ƒá‹µ áŠ áˆá‰°áˆ°áŒ áˆ';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMsg = 'âŒ áŠ áŠ«á‰£á‰¢ áˆ˜áˆ¨áŒƒ á‹¨áˆˆáˆ';
                        break;
                    case error.TIMEOUT:
                        errorMsg = 'âŒ áŠ áŠ«á‰£á‰¢ áˆ˜áŒ á‹¨á‰… áŒŠá‹œá‹ áŠ áˆááˆ';
                        break;
                }
                
                showToast(errorMsg, 4000);
            },
            options
        );
    }

    // Deny location
    function denyLocation() {
        locationModal.style.display = 'none';
        showToast('ğŸ‘Œ áŠ¥áˆºá£ áŠ áŠ«á‰£á‰¢ áŠ áˆá‰°áŒ á‹¨á‰€áˆ', 2000);
    }

    // Show PWA popup after 10 seconds
    function showPWApopup() {
        const isInstalled = localStorage.getItem('pwaInstalled') === 'true';
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
        const isDismissed = localStorage.getItem('pwaPopupDismissed') === 'true';
        
        if (isInstalled || isStandalone || isDismissed) return;
        
        pwaPopup.style.display = 'block';
        console.log("ğŸ“± PWA popup shown after 10 seconds");
    }

    // Install PWA
    function installPWA() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(choice => {
                if (choice.outcome === 'accepted') {
                    console.log('âœ… User accepted PWA install');
                    localStorage.setItem('pwaInstalled', 'true');
                    hidePWApopup();
                    showToast('âœ… áŠ á•á‹ á‰°áŒ«áŠ—áˆ!', 3000);
                } else {
                    console.log('âŒ User dismissed install prompt');
                    dismissPWA();
                }
                deferredPrompt = null;
            });
        } else {
            showManualInstall();
        }
    }

    // Dismiss PWA
    function dismissPWA() {
        hidePWApopup();
        localStorage.setItem('pwaPopupDismissed', 'true');
        showToast('ğŸ‘Œ áŠ¥áˆºá£ á‰ áŠ‹áˆ‹ áˆ‹á‹­ áŠ¥áŠ•á‹°áŒˆáŠ“ áŠ¥áŠ“áˆ³á‹­á‹á‰³áˆˆáŠ•', 2000);
    }

    function hidePWApopup() {
        pwaPopup.style.display = 'none';
    }

    function showManualInstall() {
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        
        let instructions = '';
        
        if (isIOS) {
            instructions = 'ğŸ“± áˆˆáŠ á‹­ááŠ•/áŠ á‹­á“á‹µ:\n' +
                       '1. á‰ áˆ³á‹áˆª áˆ‹á‹­ á‹¨áˆ›áŒ‹áˆ«á‰µ áŠ á‹¶áŠ• á‹­áŒ«áŠ‘ (â¬†ï¸)\n' +
                       '2. "á‹ˆá‹° áˆ˜áŠáˆ» áˆ›á‹áŒ« áŒ¨áˆáˆ­" á‹­áˆáˆ¨áŒ¡\n' +
                       '3. "áŠ áŠ­áˆ" á‹¨áˆšáˆˆá‹áŠ• á‹­áŒ«áŠ‘';
        } else if (isAndroid) {
            instructions = 'ğŸ“± áˆˆáŠ áŠ•á‹µáˆ®á‹­á‹µ:\n' +
                       '1. á‰ á‰»áˆ®áˆ áˆ‹á‹­ áˆ¶áˆµá‰µ áŠáŒ¥á‰¥ (â‹®) á‹­áŒ«áŠ‘\n' +
                       '2. "á‹ˆá‹° áˆ˜áŠáˆ» áˆ›á‹áŒ« áŒ¨áˆáˆ­" á‹­áˆáˆ¨áŒ¡\n' +
                       '3. "áŠ áŠ­áˆ" á‹¨áˆšáˆˆá‹áŠ• á‹­áŒ«áŠ‘';
        } else {
            instructions = 'ğŸ“± áŠ¥á‰£áŠ­á‹ áˆµáˆáŠ­á‹áŠ• á‹­áŒ á‰€áˆ™';
        }
        
        alert('ğŸ“‹ áŠ¥áŠ•á‹´á‰µ áŠ á•áŠ• áŠ¥áŠ•á‹°áˆšáŒ¨áˆáˆ©:\n\n' + instructions);
        hidePWApopup();
    }

    // Show toast
    function showToast(message, duration = 3000) {
        toast.textContent = message;
        toast.style.display = 'block';
        toast.style.animation = 'none';
        setTimeout(() => {
            toast.style.animation = 'fadeInOut 3s ease';
        }, 10);
        
        setTimeout(() => {
            toast.style.display = 'none';
        }, duration);
    }

    // Initialize PWA
    function initPWA() {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js?v=12')
                .then(reg => {
                    console.log('âœ… Service Worker registered');
                })
                .catch(err => {
                    console.log('âŒ Service Worker failed:', err);
                });
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('ğŸ“± PWA install prompt available');
        });

        window.addEventListener('appinstalled', () => {
            console.log('ğŸ‰ PWA installed');
            hidePWApopup();
            localStorage.setItem('pwaInstalled', 'true');
            showToast('âœ… áŠ á•á‹ á‰°áŒ«áŠ—áˆ!', 3000);
        });
    }

    // Update online/offline status
    function updateOnlineStatus() {
        offlineIndicator.style.display = navigator.onLine ? 'none' : 'block';
    }

    // Update streak UI
    function updateStreakUI() {
        const s = parseInt(localStorage.getItem('userStreak')) || 0;
        for(let i=1; i<=3; i++) {
            const elem = document.getElementById('s'+i);
            if (elem) {
                elem.classList.toggle('active', i <= s);
            }
        }
    }

    function openCheckout() {
        const name = document.getElementById('custName').value.trim();
        const phone = document.getElementById('custPhone').value.trim();
        const landmark = document.getElementById('custLandmark').value.trim() || "áŠ áˆá‰°áŒ á‰€áˆ°áˆ";
        
        if(!name || !phone) {
            alert("áŠ¥á‰£áŠ­á‹ áˆµáˆ áŠ¥áŠ“ áˆµáˆáŠ­ á‹«áˆµáŒˆá‰¡!");
            return;
        }

        let foodTotal = 0;
        let selected = [];
        document.querySelectorAll('input[type="checkbox"]:checked').forEach(box => {
            selected.push(box.value);
            foodTotal += parseInt(box.getAttribute('data-price'));
        });

        if(selected.length === 0) {
            alert("áŠ¥á‰£áŠ­á‹ á‰¢á‹«áŠ•áˆµ áŠ áŠ•á‹µ áˆáŒá‰¥ á‹­áˆáˆ¨áŒ¡!");
            return;
        }

        const total = foodTotal + DELIVERY_FEE;
        orderData = { name, phone, landmark, items: selected.join(", "), foodTotal, total };
        document.getElementById('foodTotal').innerText = foodTotal;
        document.getElementById('modalTotal').innerText = total;
        document.getElementById('paymentModal').style.display = "block";
    }

    function closeModal() { 
        document.getElementById('paymentModal').style.display = "none"; 
    }

    // FIXED: Send to Telegram with /order command
    function sendToTelegram() {
        // Save order data
        localStorage.setItem('lastOrder', JSON.stringify(orderData));
        
        // Try to get location from sessionStorage if not already set
        if (!userLat || !userLng) {
            const savedLocation = sessionStorage.getItem('userLocation');
            if (savedLocation) {
                const loc = JSON.parse(savedLocation);
                userLat = loc.lat;
                userLng = loc.lng;
            }
        }
        
        // Build the message starting with /order
        const message = createOrderMessage();
        
        // FIXED: Use correct Telegram URL format - NO "?start="
        // Telegram Web URLs work differently. We need to use "?text=" parameter
        const encodedMessage = encodeURIComponent(message);
        
        // METHOD 1: Direct message to bot (most reliable)
        const telegramUrl = `https://t.me/${BOT_USERNAME}?text=${encodedMessage}`;
        
        // METHOD 2: Alternative format (for some Telegram versions)
        // const telegramUrl = `tg://msg?text=${encodedMessage}&to=${BOT_USERNAME}`;
        
        console.log("ğŸ“± Telegram URL:", telegramUrl);
        console.log("ğŸ“¦ Message to send:", message);
        
        // Open Telegram with the message
        window.open(telegramUrl, '_blank');
        
        // Show confirmation
        setTimeout(() => {
            alert("âœ… á‰µá‹•á‹›á‹á‹ á‰°áˆáŠ³áˆ!\n\n" +
                  "á‹ˆá‹° á‰´áˆŒáŒáˆ«áˆ á‰°áˆ‹áŠ­á‹á‰³áˆá¢ áˆ˜áˆáŠ¥áŠ­á‰± áŠ¨á‰°áŠ¨áˆá‰° á‰ áŠ‹áˆ‹ 'SEND' á‹¨áˆšáˆˆá‹áŠ• á‹­áŒ«áŠ‘á¢");
            closeModal();
            clearForm();
        }, 500);
    }

    // Create order message with /order command
    function createOrderMessage() {
        let locationInfo = "";
        let mapUrl = "";
        
        if (userLat && userLng) {
            locationInfo = `ğŸ“ Location: ${userLat.toFixed(6)}, ${userLng.toFixed(6)}`;
            mapUrl = `ğŸ—ºï¸ Map: https://www.google.com/maps?q=${userLat},${userLng}`;
        } else {
            locationInfo = "ğŸ“ Location: Not provided";
            mapUrl = "";
        }
        
        // Streak Logic
        if(orderData.foodTotal >= 600) {
            let streak = parseInt(localStorage.getItem('userStreak')) || 0;
            let last = localStorage.getItem('lastDate');
            let today = new Date().toDateString();
            if(last !== today) {
                streak = (last === new Date(Date.now() - 86400000).toDateString()) ? streak + 1 : 1;
                localStorage.setItem('userStreak', streak);
                localStorage.setItem('lastDate', today);
                updateStreakUI();
            }
        }
        
        // FIXED: Start with /order command (required by bot)
        return `/order\n` +
               `ğŸ‘¤ Name: ${orderData.name}\n` +
               `ğŸ“ Phone: ${orderData.phone}\n` +
               `ğŸ  Landmark: ${orderData.landmark}\n` +
               `${locationInfo}\n` +
               `\nğŸ›’ Items:\n${orderData.items}\n\n` +
               `ğŸ’° Food Total: ${orderData.foodTotal} ETB\n` +
               `ğŸšš Delivery Fee: ${DELIVERY_FEE} ETB\n` +
               `ğŸ’µ Total: ${orderData.total} ETB\n\n` +
               `${mapUrl}\n` +
               `â° Time: ${new Date().toLocaleString('am-ET')}\n` +
               `ğŸ”¢ Order ID: BD${Date.now().toString().slice(-8)}`;
    }

    function clearForm() {
        document.getElementById('custName').value = '';
        document.getElementById('custPhone').value = '';
        document.getElementById('custLandmark').value = '';
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    }
</script>
</body>
</html>
